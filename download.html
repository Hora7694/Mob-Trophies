<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="style.css">
    <title>Mob Trophies - Download</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
    <nav>
        <a href="index.html">Home</a>
        <a href="drops.html">Drops</a>
        <a href="download.html" class="active">Download</a>
        <a href="support.html">Support</a>
    </nav>

    <div class="container">
        <h1 class="accent-text" style="text-align: center;">Latest Releases & Downloads</h1>
        
        <div id="changelog-grid" style="display: grid; gap: 25px; grid-template-columns: repeat(auto-fill, minmax(600px, 1fr)); align-items: start;">
            <p style="text-align: center; grid-column: 1 / -1;">Chargement des versions...</p>
        </div>
    </div>

    <button id="backToTop" title="Back to top">
        <img src="img/icons/UI/Arrow_Up_Icon.png" alt="Top" style="width: 20px; height: 20px;">
    </button>

    <footer>
      <div class="footer-content">
          <script type='text/javascript' src='https://storage.ko-fi.com/cdn/widget/Widget_2.js'></script>
          <script type='text/javascript'>
              kofiwidget2.init('Support me on Ko-fi', '#d63767', 'T6T117BAZT');kofiwidget2.draw();
          </script> 

          <div class="footer-links">
              <a href="index.html">Home</a>
              <a href="drops.html">Drops</a>
              <a href="download.html">Download</a>
              <a href="support.html">Support</a>
              <a href="legal.html">Terms of Service</a>
          </div>

          <div class="copyright">
              &copy; 2026 Mob Trophies (by kHorah_) - All rights reserved.
          </div>
          <div class="text-xs opacity-30 text-center" style="font-size: 0.7rem; color: var(--text-muted); margin-top: 10px;">
              This site is a fan project not affiliated with Hypixel Studios or Hytale.
          </div>
      </div>
    </footer>

    <script>
        const btnTop = document.getElementById("backToTop");

        // --- Gestion du bouton Back to Top ---
        window.addEventListener('scroll', () => {
            btnTop.style.display = window.pageYOffset > 400 ? "flex" : "none";
        });

        btnTop.addEventListener('click', () => {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        const changelogFiles = [
            //'changelog-v0.4.md',
            'changelog-v0.3.2.md',
            'changelog-v0.3.1.md',
            'changelog-v0.3.md',
            'changelog-v0.2.md'
        ];

        async function loadChangelogs() {
            const grid = document.getElementById('changelog-grid');
            grid.innerHTML = ""; 

            for (const file of changelogFiles) {
                try {
                    const response = await fetch(`changelog/${file}`);
                    if (!response.ok) {
                        console.error(`Impossible de charger : ${file}`);
                        continue;
                    }
                    const text = await response.text();

                    const titleMatch = text.match(/^# (.*)/m);
                    const title = titleMatch ? titleMatch[1] : "Update";

                    // Extraction du lien
                    const downloadMatch = text.match(/Download:\s*(https?:\/\/[^\s]+)/i);
                    const downloadUrl = downloadMatch ? downloadMatch[1] : "https://www.curseforge.com/hytale/mods/mob-trophies";

                    // Nettoyage : On enl√®ve le titre et la ligne Download pour ne pas l'afficher dans le texte
                    let bodyText = text.replace(/^# .*/m, "");
                    bodyText = bodyText.replace(/^Download:.*$/mi, ""); 

                    const card = document.createElement('div');
                    card.className = "card changelog-card glow-card";
                    card.style.display = "flex";
                    card.style.flexDirection = "column";
                    card.style.textAlign = "left";

                    card.innerHTML = `
                        <div style="display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border-color); padding-bottom: 15px; margin-bottom: 15px; gap: 20px;">
                            <div style="flex-grow: 1;">
                                <h3 class="accent-text" style="margin: 0; font-size: 1.6rem;">${title}</h3>
                            </div>
                            <a href="${downloadUrl}" target="_blank" rel="noopener noreferrer" class="btn-download-now">
                                Download now on Curseforge
                            </a>
                        </div>
                        <div class="md-content" style="font-size: 0.85rem; line-height: 1.6;">
                            ${marked.parse(bodyText)}
                        </div>
                    `;
                    grid.appendChild(card);
                } catch (err) {
                    console.error("Erreur lors du traitement du fichier : " + file, err);
                }
            }

            if (grid.innerHTML === "") {
                grid.innerHTML = "<p style='grid-column: 1/-1; text-align: center;'>No changelogs found.</p>";
            }
        }

        loadChangelogs();
    </script>
</body>
</html>